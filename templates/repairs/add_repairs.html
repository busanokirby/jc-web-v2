{% extends "layouts/base.html" %}

{% block title %}New Repair - JC Icons{% endblock %}

{% block content %}
<h1 class="mb-4"><i class="bi bi-plus-circle"></i> Create New Repair Ticket</h1>

<form method="POST" action="{{ url_for('repairs.add_repair') }}" class="needs-validation" novalidate>
    <!-- CLIENT INFORMATION -->
    <div class="card mb-4">
        <div class="card-header bg-light">
            <h5 class="mb-0"><i class="bi bi-person"></i> Client Information</h5>
        </div>
        <div class="card-body">
            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="customer_name" class="form-label">Full Name *</label>
                    <input type="text" class="form-control" id="customer_name" name="customer_name" required>
                </div>
                <div class="col-md-6">
                    <label for="business_name" class="form-label">Company Name (if applicable)</label>
                    <input type="text" class="form-control" id="business_name" name="business_name">
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="customer_phone" class="form-label">Phone Number *</label>
                    <input type="tel" class="form-control" id="customer_phone" name="customer_phone" required>
                    <small class="text-muted">Used to link to existing customer</small>
                </div>
                <div class="col-md-6">
                    <label for="customer_email" class="form-label">Email Address</label>
                    <input type="email" class="form-control" id="customer_email" name="customer_email">
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <label for="customer_address" class="form-label">Address</label>
                    <textarea class="form-control" id="customer_address" name="customer_address" rows="2"></textarea>
                </div>
            </div>
        </div>
    </div>

    <!-- DEVICE INFORMATION -->
    <div class="card mb-4">
        <div class="card-header bg-light">
            <h5 class="mb-0"><i class="bi bi-laptop"></i> Device Details</h5>
        </div>
        <div class="card-body">
            <div class="row mb-3">
                <div class="col-md-4">
                    <label for="device_type" class="form-label">Device Type *</label>
                    <select class="form-select" id="device_type" name="device_type" required>
                        <option value="">-- Select --</option>
                        <option value="printer">Printer</option>
                        <option value="laptop">Laptop</option>
                        <option value="desktop">Desktop</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label for="brand" class="form-label">Brand</label>
                    <input type="text" class="form-control" id="brand" name="brand">
                </div>
                <div class="col-md-4">
                    <label for="model" class="form-label">Model</label>
                    <input type="text" class="form-control" id="model" name="model">
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="serial_number" class="form-label">Serial Number</label>
                    <input type="text" class="form-control" id="serial_number" name="serial_number">
                </div>
                <div class="col-md-6">
                    <label for="device_age" class="form-label">Approximate Age of Device</label>
                    <input type="text" class="form-control" id="device_age" name="device_age" placeholder="e.g., 2 years, 6 months">
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-md-6">
                    <label class="form-label">Is the device under warranty?</label>
                    <div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" id="warranty_yes" name="is_warranty_repair" value="yes">
                            <label class="form-check-label" for="warranty_yes">Yes</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" id="warranty_no" name="is_warranty_repair" value="no" checked>
                            <label class="form-check-label" for="warranty_no">No</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" id="warranty_unsure" name="is_warranty_repair" value="unsure">
                            <label class="form-check-label" for="warranty_unsure">Unsure</label>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <label for="accessories" class="form-label">Accessories</label>
                    <textarea class="form-control" id="accessories" name="accessories" rows="2" placeholder="e.g., Power cable, manual, etc."></textarea>
                </div>
            </div>
        </div>
    </div>

    <!-- SERVICE REQUEST -->
    <div class="card mb-4">
        <div class="card-header bg-light">
            <h5 class="mb-0"><i class="bi bi-tools"></i> Service Request</h5>
        </div>
        <div class="card-body">
            <label class="form-label fw-bold">Type of Service Needed (Select all that apply) *</label>
            <div class="row">
                <div class="col-md-6">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="service_diagnostics" name="service_type" value="Diagnostics">
                        <label class="form-check-label" for="service_diagnostics">Diagnostics</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="service_hardware" name="service_type" value="Hardware Repair">
                        <label class="form-check-label" for="service_hardware">Hardware Repair</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="service_software" name="service_type" value="Software Repair">
                        <label class="form-check-label" for="service_software">Software Repair</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="service_os" name="service_type" value="OS Installation/Reinstallation">
                        <label class="form-check-label" for="service_os">OS Installation/Reinstallation</label>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="service_virus" name="service_type" value="Virus Removal">
                        <label class="form-check-label" for="service_virus">Virus Removal</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="service_data" name="service_type" value="Data Backup/Recovery">
                        <label class="form-check-label" for="service_data">Data Backup/Recovery</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="service_upgrade" name="service_type" value="Upgrade (RAM/SSD)">
                        <label class="form-check-label" for="service_upgrade">Upgrade (RAM/SSD)</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="service_maintenance" name="service_type" value="Maintenance/Cleaning">
                        <label class="form-check-label" for="service_maintenance">Maintenance/Cleaning</label>
                    </div>
                </div>
            </div>

            <div class="mt-4">
                <label for="issue_description" class="form-label fw-bold">Problem Description *</label>
                <small class="text-muted d-block mb-2">Describe the issue(s): Error messages, paper jams, print quality issues, connectivity problems, etc.</small>
                <textarea class="form-control" id="issue_description" name="issue_description" rows="4" required placeholder="Detailed description of the problem..."></textarea>
            </div>

            <div class="mt-3">
                <label for="symptoms" class="form-label">Additional Symptoms / Notes</label>
                <textarea class="form-control" id="symptoms" name="symptoms" rows="2" placeholder="Any other observations or symptoms"></textarea>
            </div>

            <div class="mt-3">
                <label for="device_password" class="form-label">Device Password (if applicable)</label>
                <input type="password" class="form-control" id="device_password" name="device_password" placeholder="Password for login/access if needed">
            </div>
        </div>
    </div>

    <!-- REPAIR DETAILS & AUTHORIZATION -->
    <div class="card mb-4">
        <div class="card-header bg-light">
            <h5 class="mb-0"><i class="bi bi-clipboard-check"></i> Repair Details & Authorization</h5>
        </div>
        <div class="card-body">
            <div class="row mb-3">
                <div class="col-md-3">
                    <label for="status" class="form-label">Initial Status</label>
                    <select class="form-select" id="status" name="status">
                        <option value="Received" selected>Received</option>
                        <option value="Diagnosing">Diagnosing</option>
                        <option value="Repairing">Repairing</option>
                        <option value="Waiting Parts">Waiting Parts</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label for="priority" class="form-label">Priority</label>
                    <select class="form-select" id="priority" name="priority">
                        <option value="Low">Low</option>
                        <option value="Normal" selected>Normal</option>
                        <option value="High">High</option>
                        <option value="Emergency">Emergency</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label for="technician_name_override" class="form-label">Technician in Charge</label>
                    <small class="text-muted d-block mb-2">Leave empty to use: {{ current_user.full_name }}</small>
                    <input type="text" class="form-control" id="technician_name_override" name="technician_name_override" placeholder="Enter technician name if different">
                </div>
            </div>

            <div class="alert alert-info">
                <h6><i class="bi bi-info-circle"></i> Authorization Agreement</h6>
                <ul class="mb-0 small">
                    <li>I authorize the service provider to perform diagnostics, testing, and necessary handling of my device.</li>
                    <li>I confirm that I am the authorized owner of the equipment.</li>
                    <li>I authorize the use of replacement parts (new/refurbished/third-party).</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- FINANCIAL INFORMATION (Optional at intake) -->
    <div class="card mb-4">
        <div class="card-header bg-light">
            <h5 class="mb-0"><i class="bi bi-cash-coin"></i> Financial Information</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4">
                    <label for="diagnostic_fee" class="form-label">Diagnostic Fee</label>
                    <input type="number" class="form-control" id="diagnostic_fee" name="diagnostic_fee" step="0.01" value="0.00">
                </div>
                <div class="col-md-4">
                    <label for="repair_cost" class="form-label">Estimated Repair Cost</label>
                    <input type="number" class="form-control" id="repair_cost" name="repair_cost" step="0.01" value="0.00">
                </div>
                <div class="col-md-4">
                    <label for="deposit_paid" class="form-label">Deposit Paid</label>
                    <input type="number" class="form-control" id="deposit_paid" name="deposit_paid" step="0.01" value="0.00">
                </div>
            </div>
        </div>
    </div>

    <div class="d-grid gap-2 d-sm-flex justify-content-sm-end mb-4">
        <a href="{{ url_for('repairs.repairs') }}" class="btn btn-outline-secondary">Cancel</a>
        <button type="submit" class="btn btn-primary btn-lg">
            <i class="bi bi-plus-circle"></i> Create Repair Ticket & Print Form
        </button>
    </div>
</form>
{% endblock %}
