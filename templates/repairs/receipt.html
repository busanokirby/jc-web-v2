{% extends 'layouts/base.html' %}

{% block title %}Receipt {{ device.ticket_number }} - JC Icons{% endblock %}

{% block content %}
<div class="mb-4">
  <!-- Header -->
  <div class="bg-success text-white p-4 rounded-top d-flex justify-content-between align-items-center">
    <div>
      <h1 class="mb-0"><i class="bi bi-receipt"></i> Repair Receipt</h1>
      <p class="mb-0 small">Receipt #{{ device.ticket_number }}</p>
    </div>
    <div class="d-print-none">
      <button onclick="window.print()" class="btn btn-light me-2">
        <i class="bi bi-printer"></i> Print
      </button>
      <a href="{{ url_for('repairs.repair_detail', device_id=device.id) }}" class="btn btn-light">
        <i class="bi bi-arrow-left"></i> Back
      </a>
    </div>
  </div>

  <!-- Card -->
  <div class="card border-success receipt-container">
    <div class="card-body">
      <!-- Company Header -->
      <div class="header-main mb-4 text-center">
        <img src="/static/images/jc-logo.png" alt="JC Icons Logo" style="height:60px;width:60px;border-radius:50%;">
        <div class="header-text">
          <h2 class="mb-1">JC ICONS COMPUTER SALES &amp; SERVICES</h2>
          <p class="mb-0 small text-muted">J.A CLARIN COR. HONTANOSAS, POBLACION 3, TAGBILARAN CITY</p>
        </div>
      </div>

      <hr class="my-2">

      <!-- Receipt Info -->
      <div class="row mb-3">
        <div class="col-md-6">
          <h6 class="text-muted mb-1">Receipt Number</h6>
          <h4 class="mb-0"><strong>{{ device.ticket_number }}</strong></h4>
        </div>
        <div class="col-md-6 text-end">
          <h6 class="text-muted mb-1">Date</h6>
          <p class="mb-0 small">{{ now.strftime('%B %d, %Y at %I:%M %p') }}</p>
        </div>
      </div>

      <!-- Customer Info -->
      <div class="row mb-3">
        <div class="col-md-6">
          <h6 class="text-muted mb-1">Customer</h6>
          <strong class="small">{{ device.owner.name }}</strong>
          {% if device.owner.phone %}<br><small><i class="bi bi-telephone"></i> {{ device.owner.phone }}</small>{% endif %}
          {% if device.owner.address %}<br><small><i class="bi bi-geo-alt"></i> {{ device.owner.address }}</small>{% endif %}
        </div>
        <div class="col-md-6 text-end">
          <h6 class="text-muted mb-1">Payment Status</h6>
          <span class="badge {% if device.payment_status == 'PAID' %}bg-success{% elif device.payment_status == 'PARTIAL' %}bg-warning{% else %}bg-secondary{% endif %}">
            {{ device.payment_status }}
          </span>
        </div>
      </div>

      <hr class="my-2">

      <!-- Device Details -->
      <h6 class="mb-2">Device Details</h6>
      <table class="table table-sm mb-3">
        <tbody>
          <tr><td><strong>Device</strong></td><td>{{ device.brand or 'N/A' }} {{ device.model or '' }}</td></tr>
          <tr><td><strong>Issue</strong></td><td>{{ device.issue_description }}</td></tr>
        </tbody>
      </table>

      <!-- Financial Summary -->
      <h6 class="mb-2">Financial Summary</h6>
      <table class="table table-sm mb-3">
        <tbody>
          <tr><td>Diagnostic Fee</td><td class="text-end">₱{{ "%.2f"|format(device.diagnostic_fee) }}</td></tr>
          <tr><td>Repair Cost</td><td class="text-end">₱{{ "%.2f"|format(device.repair_cost) }}</td></tr>
          <tr><td>Parts Cost</td><td class="text-end">₱{{ "%.2f"|format(device.parts_cost) }}</td></tr>
          <tr class="table-light"><td><strong>Total Cost</strong></td><td class="text-end"><strong>₱{{ "%.2f"|format(device.total_cost) }}</strong></td></tr>
        </tbody>
      </table>

      <!-- Payment Info -->
      <h6 class="mb-2">Payment Information</h6>
      <table class="table table-sm mb-3">
        <tbody>
          <tr><td>Amount Paid</td><td class="text-end">₱{{ "%.2f"|format(device.deposit_paid) }}</td></tr>
          <tr><td><strong>Balance Due</strong></td><td class="text-end"><strong>₱{{ "%.2f"|format(device.balance_due) }}</strong></td></tr>
        </tbody>
      </table>

      <!-- Footer -->
      <hr class="my-2">
      <div class="text-center text-muted" style="font-size:0.75rem;">
        <p class="mb-0">Thank you for your business!</p>
        <p class="mb-0">For inquiries, contact: (038) 411-2134</p>
        <p class="mb-0 mt-2" style="font-size:0.7rem;">{{ now.strftime('%Y-%m-%d %H:%M:%S') }}</p>
      </div>
    </div>
  </div>
</div>

<style>
  .receipt-container { max-width: 100%; }
  .header-main { display:flex; align-items:center; justify-content:center; gap:15px; flex-wrap:wrap; }
  .header-text h2 { font-size:1.3rem; font-weight:bold; margin:0; }
</style>

<style media="print">
  nav, .navbar, .d-print-none, .btn, .bg-success, footer.jc-footer { display:none !important; }
  body { font-size:10pt; line-height:1.4; }
  @page { size:A4; margin:0.3in; }
  .card { border:none !important; box-shadow:none !important; }
</style>
{% endblock %}